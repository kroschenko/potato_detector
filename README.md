# Детектор дефектор картофеля

## Установка (Ubuntu)

Для начала необходимо клонировать проект на локальный компьютер, на котором будет
выполняться программа, для этого заходим в нужную директорию  на компьютере и
применяем команду:

``
    git clone https://github.com/kroschenko/potato_detector
``

После этого заходим в директорию проекта и вводим

``
    python -m venv venv
``

Эта команда создает виртуальное окружение в системе, где будут дальше устанавливаться
все питоновские пакеты и зависимости.

Активируем виртуальное окружение командой:

``
    source venv/bin/activate
``

Для установки пакетов используется утилита pip, которую нужно установить отдельно,
если она отсутствует в системе. Для этого можно использовать команду:

``
    sudo apt install pip
``

После этого устанавливаем пакеты и зависимости, используя файл requirements.txt:

``
    pip install -r requirements.txt
``

Для корректной работы проекта с промышленной камерой **DO3THINK** в настоящий момент
требуется установка дополнительных системных пакетов. Это можно сделать командой:

``
    sudo apt install aravis-tools libaravis-0.8-0 gir1.2-aravis-0.8 aravis-tools-cli libaravis-dev libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libgstreamer-plugins-bad1.0-dev gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-tools gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio
``

После этого при подключенной камере нужно выполнить команду

``
    arv-viewer-0.8 
``

и убедиться в том, что камера появилась в списке активных устройств. Если этого не
случилось, можно попробовать запустить в режиме администратора, добавив команду 
**sudo** перед запуском.

## Запуск (Ubuntu)

Для запуска программы необходимо зайти в папку проекта и выполнить команду:

``
    python main.py
``

Программа допускает гибкую конфигурацию в зависимости от используемой камеры (или файла),
с которой будет осуществляться трансляция и последующая обработка видеопотока.

Для изменения текущих настроек нужно внести корректировки в файл configs.py.
По умолчанию предпочитаемая камера установлена на любое устройство, поддерживаемое 
библиотекой OpenCV.
Для изменения текущего предпочтительного устройства (например, на промышленную камеру
**DO3THINK**) необходимо изменить строку

``
    PREFERRED_CAMERA_DEVICE: CameraType = CameraType.DO3THINK_CAMERA
``

После такого изменения программа будет пытаться получать видеопоток от устройства
с именем **DO3THINK-04B400000199-**.

В настройках по умолчанию также отключено использование платы Arduino для контроля
пневматических устройств для выполнения сортировки.
Для его активации внесите изменения в строку

``
    USE_AIR: bool = False
``

а также проверить корректность выбранного устройства в строке 

``
    ARDUINO_PATH: str = "/dev/ttyUSB0"
``

## Известные проблемы при запуске
1. В некоторых случаях камера может быть недоступной при запуске, это связано с тем,
что текущий пользователь не имеет прав доступа к устройству. Для решения проблемы
нужно добавить камеры в группу пользователя, после этого выполнить перезагрузку
системы.

